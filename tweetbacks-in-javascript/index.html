<!DOCTYPE html>
<html>
<head>
  <title>Tweetbacks in JavaScript | Boris Smus</title>

  <meta charset='utf-8' />
  <meta name='viewport' content='width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0' />

  <meta name="description" content="A wordpress widget that uses topsy to show all of the twitterverse mentions of your blog posts." />
  <meta name="author" content="Boris Smus" />
  <link rel="canonical" href="https://smus.com/tweetbacks-in-javascript" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Tweetbacks in JavaScript" />
  <meta name="twitter:description" content="A wordpress widget that uses topsy to show all of the twitterverse mentions of your blog posts." />

  <!-- Facebook -->
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://smus.com/tweetbacks-in-javascript" />
  <meta property="og:title" content="Tweetbacks in JavaScript" />
  <meta property="og:description" content="A wordpress widget that uses topsy to show all of the twitterverse mentions of your blog posts." />

  <!-- Coil monetization experiment: https://coil.com/settings/monetize -->
  <meta name="monetization" content="$ilp.uphold.com/4Fnyw8KLaPZG">

  <!-- Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/icons/favicon-16x16.png">
  <link rel="manifest" href="/static/icons/site.webmanifest">

  <!-- Styles -->
  <link
  href='//fonts.googleapis.com/css?family=Roboto+Condensed:300|Open+Sans+Condensed:700|Source+Serif+Pro:400,700|Inconsolata' rel='stylesheet' type='text/css'>
  <link rel='stylesheet' href='/static/css/style.css'>
  <link rel='stylesheet' href='/static/css/syntax-highlight.css'>

  <!-- Feed -->
  <link href="https://smus.com/atom.xml" rel="alternate" title="Boris Smus" type="application/atom+xml"/>
</head>
<body>
<header>
  <div id='title'>
    <h1><a href='/'>Boris Smus</a></h1>
    <h2>interaction engineering</h2>
  </div>
  <nav role='navigation'>
    <a href='/about/' >About</a>
    <a href='/blog/' >Blog</a>
    <a href='/clippings/' >Clippings</a>
  </nav>
</header>

<section id='main'>
  <article>
    <a href='/tweetbacks-in-javascript'><h1 class='title'>Tweetbacks in JavaScript</h1></a>
    <div class='body'>
      <p>Every new post on this blog gets an unsolicited <a href="http://en.wikipedia.org/wiki/Pingback">pingback</a> from
<a href="http://topsy.com">topsy</a>, a service that tracks which users mentioned the post on
twitter (known informally as <a href="http://tomsucks.wordpress.com/2008/05/27/free-idea-tweetback/">tweetbacks</a>). On one hand, topsy is a
parasite, using sites like mine to rise in search engine rankings, but
on the other, it satisfies this blogger's curiosity to learn who reads
and enjoys my posts enough to tweet about them. In this experiment, I've
exposed tweetbacks directly on this blog using topsy's convenient 
<a href="http://otter.topsy.com">JSONP API</a>.</p>

<p>The implementation is entirely in JavaScript, consisting of two
scripts. The first is on the main post listing, showing the number of
tweets for each post using <code>http://otter.topsy.com/stats.js</code>. The second
is on the post page itself, showing the tweets posted in response to the
post using <code>http://otter.topsy.com/trackbacks.js</code>. Both scripts execute
after the page loads, so the only impact on page load time is the extra
kilobyte of JavaScript code. </p>

<p>There are good reasons to use topsy over <a href="http://search.twitter.com">twitter search</a>, even though
at first glance, they both provide similar information:</p>

<ul>
<li>Twitter search doesn't index old tweets</li>
<li>Topsy distinguishes influential tweets (more on this later)</li>
<li>JSONP API support</li>
</ul>

<p>It's important not to overwhelm readers by showing too many tweets.
Popular blog posts can have hundreds or even thousands of tweets, and
showing all of them at once is a bad idea. Topsy associates an influence
value with each twitter user, giving them a certain weight, making it
easier to decide which tweets to show, and which to hide. My
implementation shows at most N tweets; if there are over N total tweets,
it shows at most N 'influential' tweets, as per topsy's definition.</p>

<pre><code>var MAX_TWEETS = 10;
var BASE = 'http://otter.topsy.com/trackbacks.js?callback=?&amp;perpage=' + 
  MAX_TWEETS;
var ALL = BASE + '&amp;url=';
var INFL = BASE + '&amp;infonly=1&amp;url=';

function getTweets(url) {
  $.getJSON(ALL + url, function(data) {
    var response = data.response;
    if (response.total &gt; MAX_TWEETS) {
      $.getJSON(INFL + url, function(infl) {
        processTweetList(infl.response.list);
        var count = (infl.response.total &gt; MAX_TWEETS ? MAX_TWEETS : infl.response.total);
        updateTweetCount(count, response.total);
      });
    } else if (response.total &gt; 0) {
      processTweetList(response.list);
      updateTweetCount(response.total);
    }
  });
}
</code></pre>

<p>I also urlify the
tweet, converting all of the URLs and @mentions into <a\&gt; elements using
this function, I found the first regular expression somewhere on the
internet – I'd never write such a beast. </p>

<pre><code>var URL_RE = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&amp;@#\/%?=~_|!:,.;]*[-A-Z0-9+&amp;@#\/%=~_|])/ig;
var TWEET_RE = /@([A-Za-z0-9_]+)/g;

function urlify(text) {
  return text.replace(URL_RE,"&lt;a href='$1'&gt;$1&lt;/a&gt;").
              replace(TWEET_RE, "&lt;a href='http://twitter.com/$1'&gt;@$1&lt;/a&gt;");
</code></pre>

<p>The approach I took has some major advantages to over the <a href="http://yoast.com/wordpress/tweetbacks/">tweetback plugin</a> 
for wordpress:</p>

<ul>
<li>It works... the wordpress plugin doesn't</li>
<li>No wordpress comment pollution since no wordpress comments are
created</li>
<li>No server-side load since all comments are fetched in JS</li>
<li>No wordpress required. Other blog engines or static sites work just
as well</li>
</ul>

<p>A drawback of this approach is that it takes some time to run the JS,
which changes the DOM after the initial page load, resulting in a
jarring experience. By using a fade effect to make twitter information
appear gradually, I try to mitigate this problem. </p>

<p>I conclude with a shameless plug: tweetbacks.js is running on this blog,
so try it out by posting a tweet referring to this post's URL, and it
should appear in the list below, or if there are more than 10 tweets, at
least increment the count. If you find this concept interesting and
would like to run it on your site, let me know and I'll pack
tweetbacks.js up into a jQuery plugin or something. Thanks for reading! </p>

<p><strong>Update:</strong> I no longer use this code, in favor of the official twitter
button.</p>

    </div>
    <div class='subfooter'>
      <div class='tombstone'>▪</div>
      <time class='published'>December 16, 2010</time>
    </div>
  </article>
</section>


<footer>
  <div>
    © Copyright 2005–2022 Boris Smus.
  </div>
  <nav role="footer">
    <a href='https://smus.com/atom.xml'>RSS</a>

    <!-- Mastodon verification -->
    <a rel="me" href="https://mastodon.social/@borismus" style="display: none">Mastodon</a>
  </nav>
</footer>

<!-- Misc scripts: syntax highlighting, analytics, stats. -->
<script src="/static/js/highlight.pack.js"></script>
<script>
  // Syntax highlighting for code.
  hljs.tabReplace = '  ';
  hljs.initHighlightingOnLoad();
</script>
<script>
  // Google Analytics.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-17930798-22', 'smus.com');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');
</script>
<script src="/lightning_error.js"></script>

</body>
</html>