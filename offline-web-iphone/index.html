<!DOCTYPE html>
<html>
<head>
  <title>Offline web apps on the iPhone | Boris Smus</title>

  <meta charset='utf-8' />
  <meta name='viewport' content='width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0' />

  <meta name="description" content="A how-to about building offline-capable mobile web applications using AppCache. Also, a rough version of the Guitar Unleashed mobile app." />
  <meta name="author" content="Boris Smus" />
  <link rel="canonical" href="https://smus.com/offline-web-iphone/" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Offline web apps on the iPhone" />
  <meta name="twitter:description" content="A how-to about building offline-capable mobile web applications using AppCache. Also, a rough version of the Guitar Unleashed mobile app." />

  <!-- Facebook -->
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://smus.com/offline-web-iphone/" />
  <meta property="og:title" content="Offline web apps on the iPhone" />
  <meta property="og:description" content="A how-to about building offline-capable mobile web applications using AppCache. Also, a rough version of the Guitar Unleashed mobile app." />

  <!-- Mastodon -->
  <link rel="me" href="https://mastodon.social/@borismus">

  <!-- Coil monetization experiment: https://coil.com/settings/monetize -->
  <meta name="monetization" content="$ilp.uphold.com/4Fnyw8KLaPZG">

  <!-- Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/icons/favicon-16x16.png">
  <link rel="manifest" href="/static/icons/site.webmanifest">

  <!-- Styles -->
  <link
  href='//fonts.googleapis.com/css?family=Roboto+Condensed:300|Open+Sans+Condensed:700|Source+Serif+Pro:400,700|Inconsolata' rel='stylesheet' type='text/css'>
  <link rel='stylesheet' href='/static/css/style.css'>
  <link rel='stylesheet' href='/static/css/syntax-highlight.css'>

  <!-- Feed -->
  <link href="https://smus.com/atom.xml" rel="alternate" title="Boris Smus" type="application/atom+xml"/>
</head>
<body>
<header>
  <div id='title'>
    <h1><a href='/'>Boris Smus</a></h1>
    <h2>interaction engineering</h2>
  </div>
  <nav role='navigation'>
    <a href='/about/' >About</a>
    <a href='/blog/' >Blog</a>
    <a href='/projects/' >Projects</a>
  </nav>
</header>

<section id='main'>
  <article>
    <a href='/offline-web-iphone'><h1 class='title'>Offline web apps on the iPhone</h1></a>
    <div class='body'>
      <p>In the midst of my graduate studies, I somehow found the time to write a
simple prototype for a mobile Guitar Unleashed client. It's more of a
proof-of-concept for some cool new technologies that I've been meaning
to play with. Two things led me down this path:</p>

<ol>
<li>Since I'm no longer bound by corporate affiliation, I feel compelled
to finally develop an interesting application for iPhone.</li>
<li>I'm very bad at remembering guitar chords and lyrics, but never
bother making a cheat sheet to take to the campfire. I nearly always
have my phone in my pocket, though.</li>
</ol>

<p>The GU mobile prototype is very simple. Users can manage a list of
favorite songs, and view their lyrics with chords. At first, I set out
to create a native iPhone application to do this, but several
considerations made me change my mind:</p>

<ol>
<li>I don't want to deal with a potential App Store rejection, keeping
in mind the dubious legality of lyrics</li>
<li>The simplicity and data-centric nature of the app lends itself well
to a web implementation.</li>
</ol>

<p><img src="/offline-web-iphone/phone.png" class="left"></p>

<p>There are a few interesting technical challenges to overcome in implementing
this application. Firstly, the app needs to blend visually with the iPhone look
and feel. I chose the <a href="http://code.google.com/p/iui/">iUI</a> web framework to develop my application. In
retrospect, <a href="http://www.jqtouch.com/">jQTouch</a> would have probably been a better choice, since I ended
up using jQuery. In addition, iUI is very much not bug free, and I don't like
iUI's anchor-based navigation. Apple provides several iPhone-specific meta tags
to enhance the web experience. For example, <code>&lt;link rel="apple-touch-icon"
href="logo-touch-icon.png" /&gt;</code> allows to specify the icon that will appear in
the iPhone springboard. Setting <code>&lt;meta name="apple-touch-fullscreen"
content="YES" /&gt;</code> will remove the lower hud of MobileSafari. The full list of
options is available <a href="http://developer.apple.com/safari/library/documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html">from Apple</a>.</p>

<p>The second broad challenge for mine and iPhone web applications in general is
that they need to remain functional without an internet connection. For my
mobile client, data would be provided by two calls returning JSON:
<code>/song/search?query=myQuery</code> returning a list of songs and <code>/song/get/myID</code>
returning specific song info. My first instinct was to implement local
persistence via cookies, as is customary in web development. There's a 4K limit
on the size of each cookie, so storing all songs in one cookie was out of the
question. A simple alternative was to store a cookie with an array of song IDs,
and a cookie for each song. This strategy worked quite well on WebKit and in
the iPhone simulator. Unfortunately, cookie persistence works differently on
the actual iPhone, likely for security reasons. Every time the phone reboots,
MobileSafari's cookie jar is emptied. </p>

<p>The alternative to this is a much more modern approach: <a href="http://webkit.org/blog/126/webkit-does-html5-client-side-database-storage/">HTML5 databases</a>.
WebKit now allows you to store structured data locally in an SQLite database. I
found this approach to work very well on iPhone. The database backend persists
through reboots, as expected. I implemented both storage schemes in separate
files, available for your scrutiny: the class SongJar for cookies in <a href="/offline-web-iphone/offline-mobile/jar.js">jar.js</a>
and SongDatabase for HTML5 storage <a href="/offline-web-iphone/offline-mobile/database.js">database.js</a>.</p>

<p>The last piece of the puzzle is how to force the web application's source files
to get cached on the iPhone, so that the app remains accessible even when the
phone is offline. This is done with a <a href="http://www.w3.org/TR/2009/WD-html5-20090212/offline.html">cache manifest</a>, also new in HTML5. I
ran into several problems trying to set this up, and would have benefited from
these tips:</p>

<ol>
<li>Reference the manifest from the HTML with
<code>&lt;html manifest="cache-manifest"&gt;</code></li>
<li>Serve the manifest with the <code>text/cache-manifest</code> mime type</li>
<li>Ensure that all paths in the manifest are accessible</li>
</ol>

<p>Though my app is a mere prototype, I'm quite happy with the result.
After adding the application to the springboard, it <em>almost</em> feels like
a first class iPhone application. You can try it out at
<a href="http://www.guitarunleashed.com/m/">http://www.guitarunleashed.com/m/</a>, and please bear in mind that it's
a proof of concept.</p>

    </div>
    <div class='subfooter'>
      <div class='tombstone'>▪</div>
      <time class='published'>September 6, 2009</time>
    </div>
  </article>
</section>


<footer>
  <div>
    © Copyright 2005–2023 Boris Smus.
  </div>
  <nav role="footer">
    <a href='https://smus.com/atom.xml'>RSS</a>
  </nav>
</footer>

<!-- Misc scripts: syntax highlighting, analytics, stats. -->
<script src="/static/js/highlight.pack.js"></script>
<script>
  // Syntax highlighting for code.
  hljs.tabReplace = '  ';
  hljs.initHighlightingOnLoad();
</script>
<script>
  // Google Analytics.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-17930798-22', 'smus.com');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');
</script>
<script src="/lightning_error.js"></script>

</body>
</html>