<!DOCTYPE html>
<html>
<head>
  <title>WebIntent, an Android PhoneGap plugin | Boris Smus</title>

  <meta charset='utf-8' />
  <meta name='viewport' content='width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0' />

  <meta name="description" content="An article on how to write your own PhoneGap plugin for Android. I also write about the WebIntent plugin which lets you create Android intents from the web." />
  <meta name="author" content="Boris Smus" />
  <link rel="canonical" href="https://smus.com/android-phonegap-plugins" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="WebIntent, an Android PhoneGap plugin" />
  <meta name="twitter:description" content="An article on how to write your own PhoneGap plugin for Android. I also write about the WebIntent plugin which lets you create Android intents from the web." />

  <!-- Facebook -->
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://smus.com/android-phonegap-plugins" />
  <meta property="og:title" content="WebIntent, an Android PhoneGap plugin" />
  <meta property="og:description" content="An article on how to write your own PhoneGap plugin for Android. I also write about the WebIntent plugin which lets you create Android intents from the web." />

  <!-- Coil monetization experiment: https://coil.com/settings/monetize -->
  <meta name="monetization" content="$ilp.uphold.com/4Fnyw8KLaPZG">

  <!-- Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/icons/favicon-16x16.png">
  <link rel="manifest" href="/static/icons/site.webmanifest">

  <!-- Styles -->
  <link
  href='//fonts.googleapis.com/css?family=Roboto+Condensed:300|Open+Sans+Condensed:700|Source+Serif+Pro:400,700|Inconsolata' rel='stylesheet' type='text/css'>
  <link rel='stylesheet' href='/static/css/style.css'>
  <link rel='stylesheet' href='/static/css/syntax-highlight.css'>

  <!-- Feed -->
  <link href="https://smus.com/atom.xml" rel="alternate" title="Boris Smus" type="application/atom+xml"/>
</head>
<body>
<header>
  <div id='title'>
    <h1><a href='/'>Boris Smus</a></h1>
    <h2>interaction engineering</h2>
  </div>
  <nav role='navigation'>
    <a href='/about/' >About</a>
    <a href='/blog/' >Blog</a>
    <a href='/clippings/' >Clippings</a>
  </nav>
</header>

<section id='main'>
  <article>
    <a href='/android-phonegap-plugins'><h1 class='title'>WebIntent, an Android PhoneGap plugin</h1></a>
    <div class='body'>
      <p><a href="http://phonegap.com/">PhoneGap</a> is a very useful cross-platform web application wrapper
that lets developers package web applications into native apps. It also
lets web apps access functionality traditionally only available in
native apps. This how-to is about exposing additional Android
functionality to the web with PhoneGap plugins. <a href="http://developer.android.com/reference/android/content/Intent.html">Intents</a> are a
fundamental part of the Android ecosystem, allowing a sort of
message-passing mechanism between applications, but they are not exposed
to web applications. The sample Android plugin I wrote is called
WebIntent, which lets you create a first class Android applications in
JavaScript.</p>

<h2>WebIntent</h2>

<p>Firstly, the WebIntent plugin is a means of creating Android activities
via Intents. With just four parameters, <code>action, url, type, extras</code>,
it's possible to get a lot of mileage from the Android OS. For example,
you can send email: </p>

<pre><code>Android.sendEmail = function(subject, body) { 
  var extras = {};
  extras[WebIntent.EXTRA_SUBJECT] = subject;
  extras[WebIntent.EXTRA_TEXT] = body;
  window.plugins.webintent.startActivity({ 
      action: WebIntent.ACTION_SEND,
      type: 'text/plain', 
      extras: extras 
    }, 
    function() {}, 
    function() {
      alert('Failed to send email via Android Intent');
    }
  ); 
};
</code></pre>

<p>Or, you can load Google Maps: </p>

<pre><code>Android.showMap = function (address) {
  window.plugins.webintent.startActivity({
    action: WebIntent.ACTION_VIEW,
    url: 'geo:0,0?q=' + address,
  }, function () {}, function () {
    alert('Failed to open URL via Android Intent');
  });
};
</code></pre>

<p>Secondly, the plugin lets you react when your PhoneGap
application gets invoked with certain intents. To do this, you need to
setup correct intent-filters in the AndroidManifest.xml. For example, to
respond to ACTION_SEND, something like the following should appear in
the manifest: </p>

<pre><code>&lt;intent-filter&gt; 
  &lt;action android:name="android.intent.action.SEND" /&gt;
  &lt;category android:name="android.intent.category.DEFAULT" /&gt;
  &lt;data android:mimeType="text/plain" /&gt;
&lt;/intent-filter&gt;
</code></pre>

<p>Then, in the JavaScript, you can check what extras were specified during
invocation:</p>

<pre><code>// deviceready is PhoneGap's init event
document.addEventListener('deviceready', function () {
  window.plugins.webintent.getExtra(WebIntent.EXTRA\_TEXT, function (url) {
    // url is the value of EXTRA_TEXT 
  }, function() {
    // There was no extra supplied.
  });
});
</code></pre>

<p>This lets you respond to Intents without writing native code. The plugin
code is available for your use and/or perusal on <a href="https://github.com/phonegap/phonegap-plugins/tree/master/Android/WebIntent/">my github</a>. To install
the plugin, move <a href="https://github.com/phonegap/phonegap-plugins/blob/master/Android/WebIntent/webintent.js">webintent.js</a> to your project's www folder and include a
reference to it in your html files. Create a folder called "borismus" within
your project's src/com/ folder and move <a href="https://github.com/phonegap/phonegap-plugins/blob/master/Android/WebIntent/WebIntent.java">WebIntent.java</a> into it.  </p>

<h2>Writing Android PhoneGap Plugins</h2>

<p>The PhoneGap project provides a <a href="http://blogs.nitobi.com/joe/2009/12/17/introducing-ponygap-phonegap-plugins-for-android/">plugin architecture</a>, which isn't very
well documented. Perhaps as a result, there are very few Android plugins
(see <a href="https://github.com/phonegap/phonegap-plugins/tree/master/Android/">the github</a>). There are two parts of an Android plugin: a native
Java class that extends <code>com.phonegap.api.Plugin</code>, and a JavaScript wrapper
for that Java class. The JavaScript wrapper registers the plugin with the
PhoneGap plugin manager. A plugin API is defined in JavaScript, and exposed
via <code>window.plugins.myplugin</code>. Calling the API is done as follows: </p>

<pre><code>window.plugins.webintent.foo({ arg1: 'val1', arg2: 'val2', // etc });
</code></pre>

<p>The plugin API is defined in the <code>MyPlugin</code> JavaScript class:</p>

<pre><code>var MyPlugin = function () {};
MyPlugin.prototype.foo = function (params, success, fail) {
  return PhoneGap.exec(success, fail, 'MyPlugin', 'startActivity', [params]);
};
</code></pre>

<p>The plugin needs to be registered with PhoneGap before it can be
used. </p>

<pre><code>PhoneGap.addConstructor(function () {
  // Creates window.plugins.myplugin, an instance of MyPlugin
  PhoneGap.addPlugin('myplugin', new MyPlugin()); 
  // Binds MyPlugin to the Java class com.example.MyPlugin 
  PluginManager.addService('MyPlugin', 'com.example.MyPlugin');
});
</code></pre>

<p>Finally, there needs to be a Java class that actually implements the desired
behavior. The execute method takes an action parameter, which is the name of
the function (foo in this example), and an array of arguments: </p>

<pre><code>public class MyPlugin extends Plugin {
  public PluginResult execute(String
  action, JSONArray args, String callbackId) {
    if (action.equals("foo")) {
      // Implementation 
    }
  }
}
</code></pre>

<p>This architecture is the key to unlock any Android functionality to your
PhoneGap-wrapped mobile web application. One of huge benefits of PhoneGap
and mobile web is that it's a cross-platform solution. I admit that writing
platform-specific plugins seems counter-productive to this end. However
until the mobile web gets the love it deserves (via extra sweet mobile
browsers), there will be a place for platform-specific PhoneGap plugins to
make web applications fit better into native mobile platforms.</p>

    </div>
    <div class='subfooter'>
      <div class='tombstone'>▪</div>
      <time class='published'>November 25, 2010</time>
    </div>
  </article>
</section>


<footer>
  <div>
    © Copyright 2005–2022 Boris Smus.
  </div>
  <nav role="footer">
    <a href='https://smus.com/atom.xml'>RSS</a>
  </nav>
</footer>

<!-- Misc scripts: syntax highlighting, analytics, stats. -->
<script src="/static/js/highlight.pack.js"></script>
<script>
  // Syntax highlighting for code.
  hljs.tabReplace = '  ';
  hljs.initHighlightingOnLoad();
</script>
<script>
  // Google Analytics.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-17930798-22', 'smus.com');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');
</script>
<script src="/lightning_error.js"></script>

</body>
</html>