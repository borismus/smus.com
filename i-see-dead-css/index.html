<!DOCTYPE html>
<html>
<head>
  <title>I see dead CSS | Boris Smus</title>

  <meta charset='utf-8' />
  <meta name='viewport' content='width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0' />

  <meta name="description" content="A rudimentary attempt to write a tool that detects unused CSS styles in a stylesheet." />
  <meta name="author" content="Boris Smus" />
  <link rel="canonical" href="https://smus.com/i-see-dead-css/" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="I see dead CSS" />
  <meta name="twitter:description" content="A rudimentary attempt to write a tool that detects unused CSS styles in a stylesheet." />

  <!-- Facebook -->
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://smus.com/i-see-dead-css/" />
  <meta property="og:title" content="I see dead CSS" />
  <meta property="og:description" content="A rudimentary attempt to write a tool that detects unused CSS styles in a stylesheet." />

  <!-- Mastodon -->
  <link rel="me" href="https://mastodon.social/@borismus">

  <!-- Coil monetization experiment: https://coil.com/settings/monetize -->
  <meta name="monetization" content="$ilp.uphold.com/4Fnyw8KLaPZG">

  <!-- Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/icons/favicon-16x16.png">
  <link rel="manifest" href="/static/icons/site.webmanifest">

  <!-- Styles -->
  <link
  href='//fonts.googleapis.com/css?family=Roboto+Condensed:300|Open+Sans+Condensed:700|Source+Serif+Pro:400,700|Inconsolata' rel='stylesheet' type='text/css'>
  <link rel='stylesheet' href='/static/css/style.css'>
  <link rel='stylesheet' href='/static/css/syntax-highlight.css'>

  <!-- Feed -->
  <link href="https://smus.com/atom.xml" rel="alternate" title="Boris Smus" type="application/atom+xml"/>
</head>
<body>
<header>
  <div id='title'>
    <h1><a href='/'>Boris Smus</a></h1>
    <h2>interaction engineering</h2>
  </div>
  <nav role='navigation'>
    <a href='/about/' >About</a>
    <a href='/blog/' >Blog</a>
    <a href='/projects/' >Projects</a>
  </nav>
</header>

<section id='main'>
  <article>
    <a href='/i-see-dead-css'><h1 class='title'>I see dead CSS</h1></a>
    <div class='body'>
      <p>I wanted a tool that would analyze a complete web site, and report what
CSS selectors and IDs are dead. By dead, I mean one of two things --
either the ID or selector is referenced from the HTML and undefined in
the CSS or it is defined in the CSS but never referenced in the HTML.</p>
<p>A search for some CSS finding utilities proved somewhat fruitful. I
found a brief <a href="http://www.aggiorno.com/blogs/aggiornings/post/Detecting-unused-CSS-selectors-.aspx">survey of related utilities</a> for this finding or
cleaning dead CSS, the most promising of which was a Firefox plug-in
called <a href="http://www.sitepoint.com/dustmeselectors/">Dust-Me Selectors</a>. But I wanted something that could be
integrated into an automatic build process, easily invokable from the
command line without requiring a browser, so I started thinking about a
custom solution.</p>
<p>The problem can be solved as follows:</p>
<ol>
<li>Find all referenced IDs and classes, called R</li>
<li>Find all defined IDs and classes, called D</li>
<li>Take a difference between the sets so that the list of undefined IDs
    and classes is (R - D), and the list of unreferenced IDs and classes
    is (D - R)</li>
</ol>
<p>I've already had the pleasure of using <a href="http://www.crummy.com/software/BeautifulSoup/">BeautifulSoup</a> python library
to parse all sorts of HTML documents, and I quickly found <a href="http://cthedot.de/cssutils/">cssutils</a>
to be a very handy CSS parser. In a matter of hours I was able to whip
up a basic dead CSS finder in 100 lines of code using these great tools.
I named it 7sense, after <a href="http://www.imdb.com/title/tt0167404/">the movie</a>. To run it, you just need to
invoke <code>./7sense.py &lt;list of files and directories&gt;</code> and the specified
files will be parsed as if they were all part of the same webpage.
Directories will be walked recursively, with all encountered CSS and
HTML files assumed to be part of the web page.</p>
<p>But things are not as simple as I had hoped, and my program has several
notable limitations.</p>
<ol>
<li>Due to lack of time, 7sense does not look at what stylesheets are
    referenced by an HTML page. Instead, you have to tell it explicitly
    what stylesheets are used by passing them as arguments.</li>
<li>7sense does not properly decipher heirarchical CSS selectors like
    '#myContainer .aboutBox'. Instead, it splits the selector into
    whitespace separated tokens, ignoring their structure. I skimped on
    this feature also due to lack of time.</li>
<li>More fundamentally, 7sense is not aware of any Javascript
    modifications to the DOM. This could be remedied on a case-by-case
    basis. For example, one could write a parser to seek jQuery.setClass
    invocations, and extract additional classes from there.</li>
</ol>
<p>At any rate, here's <a href="http://www.borismus.com/wp-content/uploads/2008/12/7sense.py">7sense so far</a>. Though flawed, it's a useful
start. Ideas and code improvements, especially addressing the above
limitations are very much appreciated!</p>
    </div>
    <div class='subfooter'>
      <div class='tombstone'>▪</div>
      <time class='published'>December 11, 2008</time>
    </div>
  </article>
</section>


<footer>
  <div>
    © Copyright 2005–2023 Boris Smus.
  </div>
  <nav role="footer">
    <a href='https://smus.com/atom.xml'>RSS</a>
    <a style="display: none" rel="me" href="https://mastodon.social/@borismus">Mastodon</a>
  </nav>
</footer>

<!-- Misc scripts: syntax highlighting, analytics, stats. -->
<script src="/static/js/highlight.pack.js"></script>
<!-- Syntax highlighting for code. -->
<script>
  hljs.tabReplace = '  ';
  hljs.initHighlightingOnLoad();
</script>
<!-- Lightning builder error check. -->
<script src="/lightning_error.js"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-38Y45XD5VQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-38Y45XD5VQ');
</script>


</body>
</html>