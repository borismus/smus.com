<!DOCTYPE html>
<html>
<head>
  <title>Robotic piano playback | Boris Smus</title>

  <meta charset='utf-8' />
  <meta name='viewport' content='width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0' />

  <meta name="description" content="About a LEGO Mindstorms robot that listens to a melody and then plays it back on the piano." />
  <meta name="author" content="Boris Smus" />
  <link rel="canonical" href="https://smus.com/robotic-piano-playback" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Robotic piano playback" />
  <meta name="twitter:description" content="About a LEGO Mindstorms robot that listens to a melody and then plays it back on the piano." />

  <!-- Facebook -->
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://smus.com/robotic-piano-playback" />
  <meta property="og:title" content="Robotic piano playback" />
  <meta property="og:description" content="About a LEGO Mindstorms robot that listens to a melody and then plays it back on the piano." />

  <!-- Coil monetization experiment: https://coil.com/settings/monetize -->
  <meta name="monetization" content="$ilp.uphold.com/4Fnyw8KLaPZG">

  <!-- Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/icons/favicon-16x16.png">
  <link rel="manifest" href="/static/icons/site.webmanifest">

  <!-- Styles -->
  <link
  href='//fonts.googleapis.com/css?family=Roboto+Condensed:300|Open+Sans+Condensed:700|Source+Serif+Pro:400,700|Inconsolata' rel='stylesheet' type='text/css'>
  <link rel='stylesheet' href='/static/css/style.css'>
  <link rel='stylesheet' href='/static/css/syntax-highlight.css'>

  <!-- Feed -->
  <link href="https://smus.com/atom.xml" rel="alternate" title="Boris Smus" type="application/atom+xml"/>
</head>
<body>
<header>
  <div id='title'>
    <h1><a href='/'>Boris Smus</a></h1>
    <h2>interaction engineering</h2>
  </div>
  <nav role='navigation'>
    <a href='/about/' >About</a>
    <a href='/blog/' >Blog</a>
    <a href='/clippings/' >Clippings</a>
  </nav>
</header>

<section id='main'>
  <article>
    <a href='/robotic-piano-playback'><h1 class='title'>Robotic piano playback</h1></a>
    <div class='body'>
      <p>After several weeks of casual spare-time research and implementation,
I've finally built a fully working piano playback robot. The usage is
simple: someone plays or sings an arbitrary monophonic melody, and the
robot, parked on a piano bench, will play it back.</p>

<iframe class="youtube-16x9" title="YouTube video player"
  src="//www.youtube.com/embed/Bo0eCSkjy-0" frameborder="0"
  allowfullscreen></iframe>

<p>The physical construction of the robot is very simple: it consists of a car
with a crane-like arm mounted on it. The arm is used to push down and release a
single piano key. On either end of the car, there are sensors which detect if
the robot has come too close to the edges of the piano bench. The simplicity of
the robot comes at the price of significant limitations, such as only being
able to play back melodies on the white keys. </p>

<p>Software is the challenging part of the project. The Mindstorms sound sensor is
too primitive to use for pitch analysis. Without hacking it, you can only
extract the amplitude of the sound signal, not any frequency details.  Instead
of the NXT sound sensor, I use a macbook pro and it's built-in microphone. A
computer separate from the NXT is involved, so an additional set of
communication problems arose. </p>

<p>Here's a rough outline of happens to make the playback work, from capturing the
melody line to playing the melody back.</p>

<ol>
<li>On the mac, using a <a href="http://appscript.sourceforge.net/">Python AppleScript bridge</a>, the QuickTime
Player is invoked and starts capturing audio.</li>
<li>Once the audio is captured into an AIFF file, a very useful 
<a href="http://aubio.org/">pitch detection library</a> called aubio processes the audio file and
extracts raw frequency-to-time data, sampled at some tick rate.
Compiling this library on OS X was quite a feat!</li>
<li>Next, the raw data is processed by throwing out extraneous values
and extracting a melody</li>
<li>Once we have the melody line, we inject it into <a href="http://bricxcc.sourceforge.net/nbc/">an NXC program</a>,
and compile it with the nbc compiler</li>
<li>This program is then sent via bluetooth to the robot via nxtcom</li>
<li>Using <a href="http://home.comcast.net/~dplau/nxt_python/">NXT_Python</a> and <a href="http://www.cs.wlu.edu/~levy/software/nxt_lightblue_glue/">Lightblue Glue</a>, the robot is told to
execute the program.</li>
</ol>

<p>Please let me know if you have any questions or suggestions!</p>

    </div>
    <div class='subfooter'>
      <div class='tombstone'>▪</div>
      <time class='published'>November 15, 2008</time>
    </div>
  </article>
</section>


<footer>
  <div>
    © Copyright 2005–2022 Boris Smus.
  </div>
  <nav role="footer">
    <a href='https://smus.com/atom.xml'>RSS</a>

    <!-- Mastodon verification -->
    <a rel="me" href="https://mastodon.social/@borismus" style="display: none">Mastodon</a>
  </nav>
</footer>

<!-- Misc scripts: syntax highlighting, analytics, stats. -->
<script src="/static/js/highlight.pack.js"></script>
<script>
  // Syntax highlighting for code.
  hljs.tabReplace = '  ';
  hljs.initHighlightingOnLoad();
</script>
<script>
  // Google Analytics.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-17930798-22', 'smus.com');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');
</script>
<script src="/lightning_error.js"></script>

</body>
</html>