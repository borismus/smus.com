<!DOCTYPE html>
<html>
<head>
  <title>Nike+ hacking with python | Boris Smus</title>

  <meta charset='utf-8' />
  <meta name='viewport' content='width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0' />

  <meta name="description" content="A deep dive into the Nike+ shoe sensor and USB dongle system, and how to get data from it using Python." />
  <meta name="author" content="Boris Smus" />
  <link rel="canonical" href="https://smus.com/nike-hacking-with-python" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Nike+ hacking with python" />
  <meta name="twitter:description" content="A deep dive into the Nike+ shoe sensor and USB dongle system, and how to get data from it using Python." />

  <!-- Facebook -->
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://smus.com/nike-hacking-with-python" />
  <meta property="og:title" content="Nike+ hacking with python" />
  <meta property="og:description" content="A deep dive into the Nike+ shoe sensor and USB dongle system, and how to get data from it using Python." />


  <!-- Icons -->
  <link rel="icon" type="image/x-icon" href="/static/icons/favicon.ico" />
  <link rel="apple-touch-icon" href="/static/icons/apple-touch-icon.png">

  <!-- Styles -->
  <link
  href='//fonts.googleapis.com/css?family=Roboto+Condensed:300|Open+Sans+Condensed:700|Source+Serif+Pro:400,700|Inconsolata' rel='stylesheet' type='text/css'>
  <link rel='stylesheet' href='/static/build/style.css'>
  <link rel='stylesheet' href='/static/css/syntax-highlight.css'>

  <!-- Feed -->
  <link href="//feeds.feedburner.com/smuscom" rel="alternate" title="Boris Smus" type="application/atom+xml"/>
</head>
<body>
<header>
  <div id='title'>
    <h1><a href='/'>Boris Smus</a></h1>
    <h2>interaction engineering</h2>
  </div>
  <nav role='navigation'>
    <a href='/about/' >About</a>
    <a href='/blog/' >Blog</a>
    <a href='/clippings/' >Clippings</a>
  </nav>
</header>

<section id='main'>
  <article>
    <a href='/nike-hacking-with-python'><h1 class='title'>Nike+ hacking with python</h1></a>
    <div class='body'>
      <p><a href="http://www.apple.com/ipod/nike/">Nike+</a> is a clever little system designed by Apple and Nike to infer
the runner's speed and augment the running experience. The runner places
a small chip in his shoe which transmits data to the iPod using a
proprietary RF-based protocol. The chip contains a piezoelectric cell
which measures how long the foot exerted pressure on the ground.
According to <a href="http://support.apple.com/kb/HT2293?viewlocale=en_US">Apple's FAQ</a>, this contact time is directly related to
your pace. In this post I provide a snippet of python code for
collecting data through Sparkfun's adapter. </p>

<p>Sparkfun <a href="http://www.sparkfun.com/commerce/tutorial_info.php?tutorials_id=41">dissected</a> the transmitter and receiver and currently sell a
<a href="http://www.sparkfun.com/commerce/product_info.php?products_id=8245">Nike+ Serial to USB adapter</a>. There's been a number of <a href="http://www.sparkfun.com/commerce/tutorial_info.php?tutorials_id=135">notable</a>
<a href="http://dub.washington.edu/pubs/46%0A">projects</a> since, and quite a lot of interest in the system for
general hackery.</p>

<p>I wanted to
use Nike+ for my own project (a running bib that would automatically
display the runner's speed on the back). Unfortunately, the only
available implementations were in <a href="http://www.sparkfun.com/datasheets/DevTools/iPod/Nike_iPod_Serial.zip">Visual Basic</a> and <a href="http://rtadlock.blogspot.com/2009/06/some-perl-code-for-nikeipod-serial.html">perl</a>, neither
of which work on Mac. Here's a small script for Python on Mac OS X to
collect Nike+ data using SparkFun's adapter. </p>

<pre><code>#!/usr/bin/env python
import serial
from hexbyte import *

def readbytes(number):
    buf = ''
    for i in range(number):
        byte = ser.read()
        buf += byte

    return buf

# open the appropriate serial port
ser = serial.Serial('/dev/tty.usbserial-A6007uDh', 57600, bytesize=serial.EIGHTBITS)

# send the following init string to the Nike+ device:
init1 = 'FF 55 04 09 07 00 25 C7'
ser.write(HexToByte(init1))

# listen for the response string: FF 55 04 09 00 00 07 EC
response1 = ByteToHex(readbytes(8))
assert response1 == 'FF 55 04 09 00 00 07 EC'

# send the second init string
init2 = 'FF 55 02 09 05 F0'
ser.write(HexToByte(init2))

# listen for the response string: FF 55 04 09 06 00 25 C8
response2 = ByteToHex(readbytes(8))
assert response2 == 'FF 55 04 09 06 00 25 C8'

# now we're ready to listen for actual data
print "nike+ initialized. listening for data"

while True:
    byte = ser.read()
    # if a byte is coming down the port,
    if byte:
        # get the rest of the message (34 chars)
        message = byte + readbytes(33)
        # and decipher it
        data = {
            'number': ByteToHex(message[11]),
            'uid': ByteToHex(message[7:11]),
            'data': ByteToHex(message[12:]),
        }
        print data
</code></pre>

<p>You'll also need <a href="https://github.com/borismus/Running-Gestures/blob/master/hexbyte.py">hexbyte.py</a>, which contains convenience conversion
methods between binary and hex.</p>

<p>I'm still unable to fully make sense of this data.  Firstly, each step
seems to inexplicably generate 8 packets instead of one. Second, there
are 22 bytes in the Nike+ data <a href="http://ipodlinux.org/wiki/Apple_Accessory_Protocol#Nike.2B_.28Mode_9.29">with an unknown structure</a>, probably
containing pressure duration data. If someone figures out how to make
sense of this please let me know!</p>

<p><strong>Update (June 2013)</strong>: Dmitry Grinberg has published a <a href="http://dmitry.gr/index.php?r=05.Projects&amp;proj=05.%20Nike%20plus%20iPod">much more
thorough reverse engineering</a> blog post.</p>

    </div>
    <div class='subfooter'>
      <div class='tombstone'>▪</div>
      <time class='published'>May 18, 2010</time>
    </div>
  </article>
</section>


<footer>
  <div>
    © Copyright 2008–2018 Boris Smus.
  </div>
  <nav role="footer">
    <a href='//feeds.feedburner.com/smuscom'>RSS</a>
  </nav>
</footer>

<!-- Misc scripts: syntax highlighting, analytics, stats. -->
<script src="/static/js/highlight.pack.js"></script>
<script>
  // Syntax highlighting for code.
  hljs.tabReplace = '  ';
  hljs.initHighlightingOnLoad();
</script>
<script>
  // Google Analytics.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-17930798-22', 'smus.com');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');
</script>
<script src="/lightning_error.js"></script>

</body>
</html>